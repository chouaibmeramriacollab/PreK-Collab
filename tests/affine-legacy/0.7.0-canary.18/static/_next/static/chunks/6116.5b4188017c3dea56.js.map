{"version":3,"file":"static/chunks/6116.5b4188017c3dea56.js","mappings":"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","sources":["webpack://_N_E/./src/components/__debug__/client/editor.tsx","webpack://_N_E/./src/components/blocksuite/block-suite-editor/index.tsx","webpack://_N_E/../../packages/component/src/components/block-suite-editor/index.css.ts","webpack://_N_E/../../packages/component/src/components/block-suite-editor/index.tsx","webpack://_N_E/../../node_modules/@vanilla-extract/webpack-plugin/extracted.js?6ba6","webpack://_N_E/../../node_modules/react-error-boundary/dist/react-error-boundary.esm.js","webpack://_N_E/<anon>"],"sourcesContent":["import { initEmptyPage } from '@affine/env/blocksuite';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { createEmptyBlockSuiteWorkspace } from '@affine/workspace/utils';\nimport type { EditorContainer } from '@blocksuite/editor';\nimport type { Page } from '@blocksuite/store';\nimport { Generator } from '@blocksuite/store';\nimport type React from 'react';\nimport { useCallback } from 'react';\n\nimport { BlockSuiteEditor } from '../../blocksuite/block-suite-editor';\n\nconst blockSuiteWorkspace = createEmptyBlockSuiteWorkspace(\n  'test',\n  WorkspaceFlavour.LOCAL,\n  {\n    idGenerator: Generator.AutoIncrement,\n  }\n);\n\nconst page = blockSuiteWorkspace.createPage({ id: 'page0' });\n\nconst Editor: React.FC = () => {\n  const onLoad = useCallback((page: Page, editor: EditorContainer) => {\n    // @ts-expect-error\n    globalThis.page = page;\n    // @ts-expect-error\n    globalThis.editor = editor;\n    return () => void 0;\n  }, []);\n\n  if (!page) {\n    return <>loading...</>;\n  }\n  return (\n    <BlockSuiteEditor\n      page={page}\n      mode=\"page\"\n      onInit={initEmptyPage}\n      onLoad={onLoad}\n    />\n  );\n};\n\nexport default Editor;\n","export type { EditorProps } from '@affine/component/block-suite-editor';\nexport { BlockSuiteEditor } from '@affine/component/block-suite-editor';\n","import \"../../packages/component/src/components/block-suite-editor/index.css.ts.vanilla.css!=!../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../../packages/component/src/components/block-suite-editor/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmdsNTFjZTAgewogIG1heC13aWR0aDogdmFyKC0tYWZmaW5lLWVkaXRvci13aWR0aCk7CiAgbWFyZ2luOiAwIDJyZW07CiAgcGFkZGluZzogMCAyNHB4Owp9Ci5nbDUxY2UxIHsKICBtYXJnaW4tdG9wOiA0MHB4OwogIG1hcmdpbi1ib3R0b206IDQwcHg7Cn0=\\\"}!../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var blockSuiteEditorHeaderStyle = 'gl51ce1';\nexport var blockSuiteEditorStyle = 'gl51ce0';","import { config } from '@affine/env';\nimport { editorContainerModuleAtom } from '@affine/jotai';\nimport type { BlockHub } from '@blocksuite/blocks';\nimport type { EditorContainer } from '@blocksuite/editor';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\nimport { Skeleton } from '@mui/material';\nimport { useAtomValue } from 'jotai';\nimport type { CSSProperties, ReactElement } from 'react';\nimport { lazy, memo, Suspense, useCallback, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport type { FallbackProps } from 'react-error-boundary';\nimport { ErrorBoundary } from 'react-error-boundary';\n\nimport {\n  blockSuiteEditorHeaderStyle,\n  blockSuiteEditorStyle,\n} from './index.css';\n\nexport type EditorProps = {\n  page: Page;\n  mode: 'page' | 'edgeless';\n  onInit: (page: Page, editor: Readonly<EditorContainer>) => void;\n  onLoad?: (page: Page, editor: EditorContainer) => () => void;\n  style?: CSSProperties;\n};\n\nexport type ErrorBoundaryProps = {\n  onReset?: () => void;\n};\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var currentPage: Page | undefined;\n  // eslint-disable-next-line no-var\n  var currentEditor: EditorContainer | undefined;\n}\n\nconst ImagePreviewModal = lazy(() =>\n  import('../image-preview-modal').then(module => ({\n    default: module.ImagePreviewModal,\n  }))\n);\n\nconst BlockSuiteEditorImpl = (props: EditorProps): ReactElement => {\n  const { onLoad, page, mode, style, onInit } = props;\n  const JotaiEditorContainer = useAtomValue(\n    editorContainerModuleAtom\n  ) as typeof EditorContainer;\n  assertExists(page, 'page should not be null');\n  const editorRef = useRef<EditorContainer | null>(null);\n  const blockHubRef = useRef<BlockHub | null>(null);\n  if (editorRef.current === null) {\n    editorRef.current = new JotaiEditorContainer();\n    editorRef.current.autofocus = true;\n    globalThis.currentEditor = editorRef.current;\n  }\n  const editor = editorRef.current;\n  assertExists(editorRef, 'editorRef.current should not be null');\n  if (editor.mode !== mode) {\n    editor.mode = mode;\n  }\n\n  useEffect(() => {\n    if (editor.page !== page) {\n      editor.page = page;\n      if (page.root === null) {\n        onInit(page, editor);\n      }\n    }\n  }, [editor, page, onInit]);\n\n  useEffect(() => {\n    if (editor.page && onLoad) {\n      const disposes = [] as ((() => void) | undefined)[];\n      disposes.push(onLoad?.(page, editor));\n      return () => {\n        disposes\n          .filter((dispose): dispose is () => void => !!dispose)\n          .forEach(dispose => dispose());\n      };\n    }\n    return;\n  }, [editor, editor.page, page, onLoad]);\n\n  const ref = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const editor = editorRef.current;\n    assertExists(editor);\n    const container = ref.current;\n    if (!container) {\n      return;\n    }\n    if (page.awarenessStore.getFlag('enable_block_hub')) {\n      editor\n        .createBlockHub()\n        .then(blockHub => {\n          if (blockHubRef.current) {\n            blockHubRef.current.remove();\n          }\n          blockHubRef.current = blockHub;\n          const toolWrapper = document.querySelector('#toolWrapper');\n          if (!toolWrapper) {\n            console.warn(\n              'toolWrapper not found, block hub feature will not be available.'\n            );\n          } else {\n            toolWrapper.appendChild(blockHub);\n          }\n        })\n        .catch(err => {\n          console.error(err);\n        });\n    }\n\n    container.appendChild(editor);\n    return () => {\n      blockHubRef.current?.remove();\n      container.removeChild(editor);\n    };\n  }, [editor, page]);\n\n  // issue: https://github.com/toeverything/AFFiNE/issues/2004\n  const className = `editor-wrapper ${editor.mode}-mode`;\n  return (\n    <div\n      data-testid={`editor-${page.id}`}\n      className={className}\n      style={style}\n      ref={ref}\n    />\n  );\n};\n\nconst BlockSuiteErrorFallback = (\n  props: FallbackProps & ErrorBoundaryProps\n): ReactElement => {\n  return (\n    <div>\n      <h1>Sorry.. there was an error</h1>\n      <div>{props.error.message}</div>\n      <button\n        data-testid=\"error-fallback-reset-button\"\n        onClick={() => {\n          props.onReset?.();\n          props.resetErrorBoundary();\n        }}\n      >\n        Try again\n      </button>\n    </div>\n  );\n};\n\nexport const BlockSuiteFallback = memo(function BlockSuiteFallback() {\n  return (\n    <div className={blockSuiteEditorStyle}>\n      <Skeleton\n        className={blockSuiteEditorHeaderStyle}\n        animation=\"wave\"\n        height={50}\n      />\n      <Skeleton animation=\"wave\" height={30} width=\"40%\" />\n    </div>\n  );\n});\n\nexport const BlockSuiteEditor = memo(function BlockSuiteEditor(\n  props: EditorProps & ErrorBoundaryProps\n): ReactElement {\n  return (\n    <ErrorBoundary\n      fallbackRender={useCallback(\n        (fallbackProps: FallbackProps) => (\n          <BlockSuiteErrorFallback {...fallbackProps} onReset={props.onReset} />\n        ),\n        [props.onReset]\n      )}\n    >\n      <Suspense fallback={<BlockSuiteFallback />}>\n        <BlockSuiteEditorImpl {...props} />\n      </Suspense>\n      {config.enableImagePreviewModal && props.page && (\n        <Suspense fallback={null}>\n          {createPortal(\n            <ImagePreviewModal\n              workspace={props.page.workspace}\n              pageId={props.page.id}\n            />,\n            document.body\n          )}\n        </Suspense>\n      )}\n    </ErrorBoundary>\n  );\n});\n\nBlockSuiteEditor.displayName = 'BlockSuiteEditor';\n","// extracted by mini-css-extract-plugin","'use client';\nimport { createContext, Component, isValidElement, createElement, useContext, useState, useMemo, forwardRef } from 'react';\n\nconst ErrorBoundaryContext = createContext(null);\n\nconst initialState = {\n  didCatch: false,\n  error: null\n};\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.resetErrorBoundary = this.resetErrorBoundary.bind(this);\n    this.state = initialState;\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      didCatch: true,\n      error\n    };\n  }\n  resetErrorBoundary() {\n    const {\n      error\n    } = this.state;\n    if (error !== null) {\n      var _this$props$onReset, _this$props;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      (_this$props$onReset = (_this$props = this.props).onReset) === null || _this$props$onReset === void 0 ? void 0 : _this$props$onReset.call(_this$props, {\n        args,\n        reason: \"imperative-api\"\n      });\n      this.setState(initialState);\n    }\n  }\n  componentDidCatch(error, info) {\n    var _this$props$onError, _this$props2;\n    (_this$props$onError = (_this$props2 = this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props2, error, info);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const {\n      didCatch\n    } = this.state;\n    const {\n      resetKeys\n    } = this.props;\n\n    // There's an edge case where if the thing that triggered the error happens to *also* be in the resetKeys array,\n    // we'd end up resetting the error boundary immediately.\n    // This would likely trigger a second error to be thrown.\n    // So we make sure that we don't check the resetKeys on the first call of cDU after the error is set.\n\n    if (didCatch && prevState.error !== null && hasArrayChanged(prevProps.resetKeys, resetKeys)) {\n      var _this$props$onReset2, _this$props3;\n      (_this$props$onReset2 = (_this$props3 = this.props).onReset) === null || _this$props$onReset2 === void 0 ? void 0 : _this$props$onReset2.call(_this$props3, {\n        next: resetKeys,\n        prev: prevProps.resetKeys,\n        reason: \"keys\"\n      });\n      this.setState(initialState);\n    }\n  }\n  render() {\n    const {\n      children,\n      fallbackRender,\n      FallbackComponent,\n      fallback\n    } = this.props;\n    const {\n      didCatch,\n      error\n    } = this.state;\n    let childToRender = children;\n    if (didCatch) {\n      const props = {\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      };\n      if (isValidElement(fallback)) {\n        childToRender = fallback;\n      } else if (typeof fallbackRender === \"function\") {\n        childToRender = fallbackRender(props);\n      } else if (FallbackComponent) {\n        childToRender = createElement(FallbackComponent, props);\n      } else {\n        throw new Error(\"react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop\");\n      }\n    }\n    return createElement(ErrorBoundaryContext.Provider, {\n      value: {\n        didCatch,\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      }\n    }, childToRender);\n  }\n}\nfunction hasArrayChanged() {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return a.length !== b.length || a.some((item, index) => !Object.is(item, b[index]));\n}\n\nfunction assertErrorBoundaryContext(value) {\n  if (value == null || typeof value.didCatch !== \"boolean\" || typeof value.resetErrorBoundary !== \"function\") {\n    throw new Error(\"ErrorBoundaryContext not found\");\n  }\n  return true;\n}\n\nfunction useErrorBoundary() {\n  const context = useContext(ErrorBoundaryContext);\n  assertErrorBoundaryContext(context);\n  const [state, setState] = useState({\n    error: null,\n    hasError: false\n  });\n  const memoized = useMemo(() => ({\n    resetBoundary: () => {\n      context === null || context === void 0 ? void 0 : context.resetErrorBoundary();\n      setState({\n        error: null,\n        hasError: false\n      });\n    },\n    showBoundary: error => setState({\n      error,\n      hasError: true\n    })\n  }), [context === null || context === void 0 ? void 0 : context.resetErrorBoundary]);\n  if (state.hasError) {\n    throw state.error;\n  }\n  return memoized;\n}\n\nfunction withErrorBoundary(component, errorBoundaryProps) {\n  const Wrapped = forwardRef((props, ref) => createElement(ErrorBoundary, errorBoundaryProps, createElement(component, {\n    ...props,\n    ref\n  })));\n\n  // Format for display in DevTools\n  const name = component.displayName || component.name || \"Unknown\";\n  Wrapped.displayName = \"withErrorBoundary(\".concat(name, \")\");\n  return Wrapped;\n}\n\nexport { ErrorBoundary, ErrorBoundaryContext, useErrorBoundary, withErrorBoundary };\n"],"names":["blockSuiteWorkspace","createEmptyBlockSuiteWorkspace","WorkspaceFlavour","idGenerator","Generator","page","createPage","id","Editor","onLoad","useCallback","editor","globalThis","_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__","tZ","BlockSuiteEditor","mode","onInit","initEmptyPage","HY","__webpack_exports__","ImagePreviewModal","lazy","Promise","all","__webpack_require__","e","then","bind","module","default","BlockSuiteEditorImpl","style","props","JotaiEditorContainer","useAtomValue","editorContainerModuleAtom","assertExists","editorRef","useRef","blockHubRef","current","autofocus","currentEditor","useEffect","root","disposes","push","filter","dispose","forEach","ref","container","awarenessStore","getFlag","createBlockHub","blockHub","remove","toolWrapper","document","querySelector","appendChild","console","warn","catch","err","error","removeChild","className","concat","emotion_react_jsx_runtime_browser_esm","div","data-testid","BlockSuiteErrorFallback","BX","h1","message","button","onClick","onReset","resetErrorBoundary","BlockSuiteFallback","memo","Skeleton","animation","height","width","ErrorBoundary","fallbackRender","fallbackProps","Suspense","fallback","config","createPortal","workspace","pageId","body","displayName","ErrorBoundaryContext","react__WEBPACK_IMPORTED_MODULE_0__","createContext","initialState","didCatch","Component","constructor","state","getDerivedStateFromError","_this$props$onReset","_this$props","_len","arguments","length","args","_key","call","reason","setState","componentDidCatch","info","_this$props$onError","_this$props2","onError","componentDidUpdate","prevProps","prevState","resetKeys","hasArrayChanged","a","undefined","b","some","item","index","Object","is","_this$props$onReset2","_this$props3","next","prev","render","children","FallbackComponent","childToRender","isValidElement","createElement","Provider","value"],"sourceRoot":""}