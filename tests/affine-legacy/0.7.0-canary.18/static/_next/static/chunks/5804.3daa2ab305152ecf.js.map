{"version":3,"file":"static/chunks/5804.3daa2ab305152ecf.js","mappings":"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","sources":["webpack://_N_E/ignored|/Users/himself65/Code/old-affine/node_modules/shiki/dist|fs","webpack://_N_E/ignored|/Users/himself65/Code/old-affine/node_modules/shiki/dist|path","webpack://_N_E/../../node_modules/lit-html/directives/keyed.js","webpack://_N_E/../../node_modules/lit/directives/keyed.js","webpack://_N_E/../../node_modules/@blocksuite/editor/dist/utils/editor.js","webpack://_N_E/../../node_modules/@blocksuite/editor/dist/components/editor-container.js","webpack://_N_E/../../node_modules/@blocksuite/editor/dist/components/simple-affine-editor.js","webpack://_N_E/../../node_modules/@blocksuite/editor/dist/components/index.js","webpack://_N_E/../../node_modules/@blocksuite/editor/dist/utils/index.js","webpack://_N_E/../../node_modules/@blocksuite/editor/dist/index.js","webpack://_N_E/<anon>"],"sourcesContent":["/* (ignored) */","/* (ignored) */","import{nothing as r}from\"../lit-html.js\";import{directive as t,Directive as e}from\"../directive.js\";import{setCommittedValue as s}from\"../directive-helpers.js\";\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const i=t(class extends e{constructor(){super(...arguments),this.key=r}render(r,t){return this.key=r,t}update(r,[t,e]){return t!==this.key&&(s(r),this.key=t),e}});export{i as keyed};\n//# sourceMappingURL=keyed.js.map\n","export*from\"lit-html/directives/keyed.js\";\n//# sourceMappingURL=keyed.js.map\n","import { asyncFocusRichText, BlockHub, createBookmarkBlock, getAllowSelectedBlocks, getEdgelessPage, getServiceOrRegister, tryUpdateFrameSize, uploadImageFromLocal, } from '@blocksuite/blocks';\nimport { getClosestFrameBlockElementById, getCurrentBlockRange, getHoveringFrame, Rect, } from '@blocksuite/blocks/std';\nimport { PAGE_BLOCK_PADDING_BOTTOM } from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nexport const checkEditorElementActive = () => document.activeElement?.closest('editor-container') != null;\nexport const createBlockHub = (editor, page) => {\n    const blockHub = new BlockHub({\n        mouseRoot: editor,\n        enableDatabase: !!page.awarenessStore.getFlag('enable_database'),\n        onClickCard: async (data) => {\n            const models = [];\n            const isDatabase = data.flavour === 'affine:database';\n            if (isDatabase && !page.awarenessStore.getFlag('enable_database')) {\n                console.warn('database block is not enabled');\n                return;\n            }\n            if (data.flavour === 'affine:embed' && data.type === 'image') {\n                models.push(...(await uploadImageFromLocal(page)));\n            }\n            else {\n                models.push(data);\n            }\n            const last = page.root?.lastItem();\n            const range = getCurrentBlockRange(page);\n            if (range) {\n                const lastModel = range.models[range.models.length - 1];\n                if (data.flavour === 'affine:bookmark') {\n                    const parent = page.getParent(lastModel);\n                    assertExists(parent);\n                    const index = parent.children.indexOf(lastModel);\n                    createBookmarkBlock(parent, index + 1);\n                    return;\n                }\n                const arr = page.addSiblingBlocks(lastModel, models, 'after');\n                const lastId = arr[arr.length - 1];\n                asyncFocusRichText(page, lastId);\n            }\n            else if (last) {\n                if (data.flavour === 'affine:bookmark') {\n                    createBookmarkBlock(page.root?.lastItem());\n                    return;\n                }\n                // add to end\n                let lastId = page.root?.lastItem()?.id;\n                models.forEach(model => {\n                    lastId = page.addBlock(model.flavour ?? 'affine:paragraph', model, page.root?.lastItem());\n                });\n                lastId && asyncFocusRichText(page, lastId);\n            }\n        },\n        onDrop: async (e, point, end, type) => {\n            const dataTransfer = e.dataTransfer;\n            assertExists(dataTransfer);\n            const data = dataTransfer.getData('affine/block-hub');\n            const models = [];\n            const props = JSON.parse(data);\n            const isDatabase = props.flavour === 'affine:database';\n            if (isDatabase && !page.awarenessStore.getFlag('enable_database')) {\n                console.warn('database block is not enabled');\n                return;\n            }\n            if (props.flavour === 'affine:embed' && props.type === 'image') {\n                models.push(...(await uploadImageFromLocal(page)));\n            }\n            else {\n                models.push(props);\n            }\n            let parentId;\n            let focusId;\n            if (end && type !== 'none') {\n                const { model } = end;\n                page.captureSync();\n                if (type === 'database') {\n                    const ids = page.addBlocks(models, model);\n                    focusId = ids[0];\n                    parentId = model.id;\n                }\n                else if (props.flavour === 'affine:bookmark') {\n                    const parent = page.getParent(model);\n                    assertExists(parent);\n                    const index = parent.children.indexOf(model);\n                    focusId = createBookmarkBlock(parent, index + 1);\n                    parentId = parent.id;\n                }\n                else {\n                    const parent = page.getParent(model);\n                    assertExists(parent);\n                    const ids = page.addSiblingBlocks(model, models, type);\n                    focusId = ids[0];\n                    parentId = parent.id;\n                }\n                // database init basic structure\n                if (isDatabase) {\n                    const service = await getServiceOrRegister(props.flavour);\n                    service.initDatabaseBlock(page, model, focusId);\n                }\n            }\n            if (editor.mode === 'page') {\n                if (focusId) {\n                    asyncFocusRichText(page, focusId);\n                    tryUpdateFrameSize(page, 1);\n                }\n                return;\n            }\n            // In edgeless mode.\n            const pageBlock = getEdgelessPage(page);\n            assertExists(pageBlock);\n            let frameId;\n            if (focusId && parentId) {\n                const targetFrameBlock = getClosestFrameBlockElementById(parentId, pageBlock);\n                assertExists(targetFrameBlock);\n                frameId = targetFrameBlock.model.id;\n            }\n            else {\n                // Creates new frame block on blank area.\n                const result = pageBlock.addNewFrame(models, point);\n                frameId = result.frameId;\n                focusId = result.ids[0];\n            }\n            pageBlock.setSelection(frameId, true, focusId, point);\n        },\n        onDragStart: () => {\n            if (editor.mode === 'page') {\n                const defaultPageBlock = editor.querySelector('affine-default-page');\n                assertExists(defaultPageBlock);\n                defaultPageBlock.selection.clear();\n            }\n        },\n        getAllowedBlocks: () => {\n            if (editor.mode === 'page') {\n                const defaultPageBlock = editor.querySelector('affine-default-page');\n                assertExists(defaultPageBlock);\n                return getAllowSelectedBlocks(defaultPageBlock.model);\n            }\n            else {\n                const edgelessPageBlock = editor.querySelector('affine-edgeless-page');\n                assertExists(edgelessPageBlock);\n                return getAllowSelectedBlocks(edgelessPageBlock.model);\n            }\n        },\n        getHoveringFrameState: (point) => {\n            const state = {\n                scale: 1,\n            };\n            if (editor.mode === 'page') {\n                const defaultPageBlock = editor.querySelector('affine-default-page');\n                assertExists(defaultPageBlock);\n                const rect = Rect.fromDOMRect(defaultPageBlock.pageBlockContainer.getBoundingClientRect());\n                rect.height -= PAGE_BLOCK_PADDING_BOTTOM;\n                state.rect = rect;\n            }\n            else {\n                const edgelessPageBlock = editor.querySelector('affine-edgeless-page');\n                assertExists(edgelessPageBlock);\n                state.scale = edgelessPageBlock.surface.viewport.zoom;\n                const container = getHoveringFrame(point);\n                if (container) {\n                    state.rect = Rect.fromDOM(container);\n                    state.container = container;\n                }\n            }\n            return state;\n        },\n        page,\n    });\n    return blockHub;\n};\n//# sourceMappingURL=editor.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { activeEditorManager, edgelessPreset, getPageBlock, getServiceOrRegister, pagePreset, ThemeObserver, } from '@blocksuite/blocks';\nimport { BlockSuiteRoot, ShadowlessElement, WithDisposable, } from '@blocksuite/lit';\nimport { isFirefox, Slot } from '@blocksuite/store';\nimport { html } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { keyed } from 'lit/directives/keyed.js';\nimport { checkEditorElementActive, createBlockHub } from '../utils/editor.js';\nBlockSuiteRoot;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction forwardSlot(from, to) {\n    Object.entries(from).forEach(([key, slot]) => {\n        const target = to[key];\n        if (target) {\n            slot.pipe(target);\n        }\n    });\n}\nlet EditorContainer = class EditorContainer extends WithDisposable(ShadowlessElement) {\n    constructor() {\n        super(...arguments);\n        this.mode = 'page';\n        this.autofocus = false;\n        this.themeObserver = new ThemeObserver();\n        this.slots = {\n            pageLinkClicked: new Slot(),\n            pageModeSwitched: new Slot(),\n        };\n    }\n    get model() {\n        return this.page.root;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        activeEditorManager.setIfNoActive(this);\n        const keydown = (e) => {\n            if (e.altKey && e.metaKey && e.code === 'KeyC') {\n                e.preventDefault();\n            }\n            // `esc`  clear selection\n            if (e.code !== 'Escape') {\n                return;\n            }\n            const pageModel = this.model;\n            if (!pageModel)\n                return;\n            if (this.mode === 'page') {\n                getPageBlock(pageModel)?.selection.clear();\n            }\n            const selection = getSelection();\n            if (!selection || selection.isCollapsed || !checkEditorElementActive()) {\n                return;\n            }\n            selection.removeAllRanges();\n        };\n        // Question: Why do we prevent this?\n        if (isFirefox) {\n            this._disposables.addFromEvent(document.body, 'keydown', keydown);\n        }\n        else {\n            this._disposables.addFromEvent(window, 'keydown', keydown);\n        }\n        if (!this.page) {\n            throw new Error('Missing page for EditorContainer!');\n        }\n        // connect mouse mode event changes\n        // this._disposables.addFromEvent(\n        //   window,\n        //   'affine.switch-mouse-mode',\n        //   ({ detail }) => {\n        //     this.mouseMode = detail;\n        //   }\n        // );\n        // subscribe store\n        this._disposables.add(this.page.slots.rootAdded.on(() => {\n            // add the 'page' as requesting property to\n            // make sure the `forwardSlot` is called in `updated` lifecycle\n            this.requestUpdate('page');\n        }));\n        this._disposables.add(this.page.slots.blockUpdated.on(async ({ type, id }) => {\n            const block = this.page.getBlockById(id);\n            if (!block)\n                return;\n            if (type === 'update') {\n                const service = await getServiceOrRegister(block.flavour);\n                service.updateEffect(block);\n            }\n        }));\n        this.themeObserver.observer(document.documentElement);\n        this._disposables.add(this.themeObserver);\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        activeEditorManager.clearActive();\n        this.page.awarenessStore.setLocalRange(this.page, null);\n    }\n    firstUpdated() {\n        // todo: refactor to a better solution\n        getServiceOrRegister('affine:code');\n        if (this.mode === 'page') {\n            setTimeout(() => {\n                const defaultPage = this.querySelector('affine-default-page');\n                if (this.autofocus) {\n                    defaultPage?.titleVEditor.focusEnd();\n                }\n            });\n        }\n    }\n    updated(changedProperties) {\n        if (changedProperties.has('mode')) {\n            this.slots.pageModeSwitched.emit(this.mode);\n        }\n        if (!changedProperties.has('page') && !changedProperties.has('mode')) {\n            return;\n        }\n        requestAnimationFrame(() => {\n            if (this._defaultPageBlock) {\n                forwardSlot(this._defaultPageBlock.slots, this.slots);\n            }\n            if (this._edgelessPageBlock) {\n                forwardSlot(this._edgelessPageBlock.slots, this.slots);\n            }\n        });\n    }\n    async createBlockHub() {\n        await this.updateComplete;\n        if (!this.page.root) {\n            await new Promise(res => this.page.slots.rootAdded.once(res));\n        }\n        return createBlockHub(this, this.page);\n    }\n    render() {\n        if (!this.model)\n            return null;\n        const rootContainer = keyed(this.model.id, html `<block-suite-root\n        .page=${this.page}\n        .componentMap=${this.mode === 'page' ? pagePreset : edgelessPreset}\n      ></block-suite-root>`);\n        const remoteSelectionContainer = html `\n      <remote-selection .page=${this.page}></remote-selection>\n    `;\n        return html `\n      <style>\n        editor-container * {\n          box-sizing: border-box;\n        }\n        editor-container,\n        .affine-editor-container {\n          display: block;\n          height: 100%;\n          position: relative;\n          overflow: hidden;\n          font-family: var(--affine-font-family);\n          background: var(--affine-background-primary-color);\n        }\n        @media print {\n          editor-container,\n          .affine-editor-container {\n            height: auto;\n          }\n        }\n      </style>\n      ${rootContainer} ${remoteSelectionContainer}\n    `;\n    }\n};\n__decorate([\n    property()\n], EditorContainer.prototype, \"page\", void 0);\n__decorate([\n    property()\n], EditorContainer.prototype, \"mode\", void 0);\n__decorate([\n    property()\n], EditorContainer.prototype, \"autofocus\", void 0);\n__decorate([\n    query('affine-default-page')\n], EditorContainer.prototype, \"_defaultPageBlock\", void 0);\n__decorate([\n    query('affine-edgeless-page')\n], EditorContainer.prototype, \"_edgelessPageBlock\", void 0);\nEditorContainer = __decorate([\n    customElement('editor-container')\n], EditorContainer);\nexport { EditorContainer };\n//# sourceMappingURL=editor-container.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { AffineSchemas } from '@blocksuite/blocks/models';\nimport { Workspace } from '@blocksuite/store';\nimport { LitElement } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { EditorContainer } from './editor-container.js';\n/**\n * This is the editor component to be used out-of-the-box.\n * It always starts with an empty local page state,\n * so it doesn't enable the opt-in collaboration and data persistence features.\n * But it's already self-contained and sufficient for embedded use in regular web applications.\n * You can use `editor.importMarkdown` to load markdown content.\n */\nlet SimpleAffineEditor = class SimpleAffineEditor extends LitElement {\n    constructor() {\n        super();\n        this.workspace = new Workspace({ id: 'test' }).register(AffineSchemas);\n        this.page = this.workspace.createPage({ id: 'page0' });\n        const pageBlockId = this.page.addBlock('affine:page');\n        const frameId = this.page.addBlock('affine:frame', {}, pageBlockId);\n        this.page.addBlock('affine:paragraph', {}, frameId);\n    }\n    connectedCallback() {\n        const editor = new EditorContainer();\n        editor.page = this.page;\n        this.appendChild(editor);\n    }\n    disconnectedCallback() {\n        this.removeChild(this.children[0]);\n    }\n};\nSimpleAffineEditor = __decorate([\n    customElement('simple-affine-editor')\n], SimpleAffineEditor);\nexport { SimpleAffineEditor };\n//# sourceMappingURL=simple-affine-editor.js.map","import './editor-container.js';\nimport './simple-affine-editor.js';\nexport * from './editor-container.js';\nexport * from './simple-affine-editor.js';\n//# sourceMappingURL=index.js.map","export * from './editor.js';\n//# sourceMappingURL=index.js.map","export * from './components/index.js';\nexport * from './utils/index.js';\nconst env = typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof window !== 'undefined'\n        ? window\n        : // @ts-ignore\n            typeof global !== 'undefined'\n                ? // @ts-ignore\n                    global\n                : {};\nconst importIdentifier = '__ $BLOCKSUITE_EDITOR$ __';\n// @ts-ignore\nif (env[importIdentifier] === true) {\n    // https://github.com/yjs/yjs/issues/438\n    console.error('@blocksuite/editor was already imported. This breaks constructor checks and will lead to issues!');\n}\nif (typeof window === 'undefined') {\n    throw new Error('Seems like you are importing @blocksuite/editor in SSR mode. Which is not supported for now.');\n}\n// @ts-ignore\nenv[importIdentifier] = true;\n//# sourceMappingURL=index.js.map"],"names":["i","directive","XM","Xe","constructor","arguments","key","lit_html","Ld","render","r","t","update","e","directive_helpers","hl","checkEditorElementActive","document","activeElement","closest","createBlockHub","editor","page","blockHub","dist","BlockHub","mouseRoot","enableDatabase","awarenessStore","getFlag","onClickCard","data","models","isDatabase","flavour","console","warn","type","push","uploadImageFromLocal","last","root","lastItem","range","std","zE","lastModel","length","parent","getParent","utils","kP","index","children","indexOf","createBookmarkBlock","arr","addSiblingBlocks","lastId","asyncFocusRichText","id","forEach","model","addBlock","onDrop","point","end","parentId","focusId","frameId","dataTransfer","getData","props","JSON","parse","captureSync","ids","addBlocks","service","getServiceOrRegister","initDatabaseBlock","mode","tryUpdateFrameSize","pageBlock","getEdgelessPage","targetFrameBlock","lK","result","addNewFrame","setSelection","onDragStart","defaultPageBlock","querySelector","selection","clear","getAllowedBlocks","getAllowSelectedBlocks","edgelessPageBlock","getHoveringFrameState","state","scale","rect","UL","fromDOMRect","pageBlockContainer","getBoundingClientRect","height","consts","rj","surface","viewport","zoom","container","ev","fromDOM","__decorate","decorators","target","desc","d","c","Object","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","forwardSlot","from","to","entries","slot","pipe","lit_dist","zN","EditorContainer","$T","Zi","autofocus","themeObserver","ThemeObserver","slots","pageLinkClicked","store_dist","g7","pageModeSwitched","connectedCallback","activeEditorManager","setIfNoActive","keydown","altKey","metaKey","code","preventDefault","pageModel","getPageBlock","getSelection","isCollapsed","removeAllRanges","vU","_disposables","addFromEvent","body","window","add","rootAdded","on","requestUpdate","blockUpdated","block","getBlockById","updateEffect","observer","documentElement","disconnectedCallback","clearActive","setLocalRange","firstUpdated","setTimeout","defaultPage","titleVEditor","focusEnd","updated","changedProperties","has","emit","requestAnimationFrame","_defaultPageBlock","_edgelessPageBlock","updateComplete","Promise","res","once","rootContainer","lit","dy","pagePreset","edgelessPreset","remoteSelectionContainer","Cb","prototype","IO","Mo","SimpleAffineEditor","oi","workspace","j$","register","P","createPage","pageBlockId","appendChild","removeChild","simple_affine_editor_decorate","env","globalThis","global","importIdentifier","error"],"sourceRoot":""}