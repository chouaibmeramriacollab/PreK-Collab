{"version":3,"file":"static/chunks/pages/index-c6bdcd34e4de98ec.js","mappings":"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","sources":["webpack://_N_E/","webpack://_N_E/./src/pages/index.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/\",\n      function () {\n        return require(\"private-next-pages/index.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/\"])\n      });\n    }\n  ","import { WorkspaceFallback } from '@affine/component/workspace';\nimport { DebugLogger } from '@affine/debug';\nimport { WorkspaceSubPath } from '@affine/env/workspace';\nimport type { NextPage } from 'next';\nimport { useRouter } from 'next/router';\nimport { Suspense, useEffect } from 'react';\n\nimport { PageLoading } from '../components/pure/loading';\nimport { RouteLogic, useRouterHelper } from '../hooks/use-router-helper';\nimport { useAppHelper, useWorkspaces } from '../hooks/use-workspaces';\nimport { AllWorkspaceContext } from '../layouts/workspace-layout';\nimport { AllWorkspaceModals } from '../providers/modal-provider';\n\nconst logger = new DebugLogger('index-page');\n\nconst IndexPageInner = () => {\n  const router = useRouter();\n  const { jumpToPage, jumpToSubPath } = useRouterHelper(router);\n  const workspaces = useWorkspaces();\n  const helper = useAppHelper();\n\n  useEffect(() => {\n    if (!router.isReady) {\n      return;\n    }\n    const lastId = localStorage.getItem('last_workspace_id');\n    const lastPageId = localStorage.getItem('last_page_id');\n    const targetWorkspace =\n      (lastId && workspaces.find(({ id }) => id === lastId)) ||\n      workspaces.at(0);\n\n    if (targetWorkspace) {\n      const nonTrashPages =\n        targetWorkspace.blockSuiteWorkspace.meta.pageMetas.filter(\n          ({ trash }) => !trash\n        );\n      const pageId =\n        nonTrashPages.find(({ id }) => id === lastPageId)?.id ??\n        nonTrashPages.at(0)?.id;\n      if (pageId) {\n        logger.debug('Found target workspace. Jump to page', pageId);\n        jumpToPage(targetWorkspace.id, pageId, RouteLogic.REPLACE).catch(\n          err => {\n            console.error(err);\n          }\n        );\n      } else {\n        const clearId = setTimeout(() => {\n          dispose.dispose();\n          logger.debug('Found target workspace. Jump to all pages');\n          jumpToSubPath(\n            targetWorkspace.id,\n            WorkspaceSubPath.ALL,\n            RouteLogic.REPLACE\n          ).catch(err => {\n            console.error(err);\n          });\n        }, 1000);\n        const dispose =\n          targetWorkspace.blockSuiteWorkspace.slots.pageAdded.once(pageId => {\n            clearTimeout(clearId);\n            jumpToPage(targetWorkspace.id, pageId, RouteLogic.REPLACE).catch(\n              err => {\n                console.error(err);\n              }\n            );\n          });\n        return () => {\n          clearTimeout(clearId);\n          dispose.dispose();\n        };\n      }\n    } else {\n      console.warn('No target workspace. This should not happen in production');\n    }\n    return;\n  }, [helper, jumpToPage, jumpToSubPath, router, workspaces]);\n\n  return (\n    <Suspense fallback={<WorkspaceFallback />}>\n      <AllWorkspaceContext>\n        <AllWorkspaceModals />\n      </AllWorkspaceContext>\n    </Suspense>\n  );\n};\n\nconst IndexPage: NextPage = () => {\n  return (\n    <Suspense fallback={<PageLoading />}>\n      <IndexPageInner />\n    </Suspense>\n  );\n};\n\nexport default IndexPage;\n"],"names":["window","__NEXT_P","push","__webpack_require__","logger","DebugLogger","IndexPageInner","router","useRouter","jumpToPage","jumpToSubPath","useRouterHelper","workspaces","useWorkspaces","helper","useAppHelper","useEffect","isReady","lastId","localStorage","getItem","lastPageId","targetWorkspace","find","id","param","at","nonTrashPages","blockSuiteWorkspace","meta","pageMetas","filter","trash","pageId","debug","RouteLogic","catch","err","console","error","clearId","setTimeout","dispose","WorkspaceSubPath","slots","pageAdded","once","clearTimeout","warn","_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__","tZ","Suspense","fallback","WorkspaceFallback","AllWorkspaceContext","AllWorkspaceModals","IndexPage","PageLoading","__webpack_exports__"],"sourceRoot":""}