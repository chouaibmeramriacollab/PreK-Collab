{"version":3,"file":"static/chunks/pages/workspace/[workspaceId]/[pageId]-29f764157e94b5f8.js","mappings":"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","sources":["webpack://_N_E/?89a6","webpack://_N_E/../../packages/component/src/components/page-detail-skeleton/index.css.ts","webpack://_N_E/../../packages/component/src/components/page-detail-skeleton/index.tsx","webpack://_N_E/./src/pages/workspace/[workspaceId]/[pageId].tsx","webpack://_N_E/../../packages/component/src/components/block-suite-editor/index.css.ts","webpack://_N_E/../../packages/component/src/components/block-suite-editor/index.tsx","webpack://_N_E/../../node_modules/@vanilla-extract/webpack-plugin/extracted.js?6ba6","webpack://_N_E/../../node_modules/@vanilla-extract/webpack-plugin/extracted.js?857d","webpack://_N_E/../../node_modules/react-error-boundary/dist/react-error-boundary.esm.js","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/workspace/[workspaceId]/[pageId]\",\n      function () {\n        return require(\"private-next-pages/workspace/[workspaceId]/[pageId].tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/workspace/[workspaceId]/[pageId]\"])\n      });\n    }\n  ","import \"../../packages/component/src/components/page-detail-skeleton/index.css.ts.vanilla.css!=!../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../../packages/component/src/components/page-detail-skeleton/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xY2kyZTZpMCB7CiAgcGFkZGluZzogMCAyMHB4Owp9Ci5fMWNpMmU2aTEgewogIGhlaWdodDogNTJweDsKICB3aWR0aDogMTAwJTsKfQ==\\\"}!../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var pageDetailSkeletonStyle = '_1ci2e6i0';\nexport var pageDetailSkeletonTitleStyle = '_1ci2e6i1';","import { BlockSuiteFallback } from '../block-suite-editor';\nimport {\n  pageDetailSkeletonStyle,\n  pageDetailSkeletonTitleStyle,\n} from './index.css';\n\nexport const PageDetailSkeleton = () => {\n  return (\n    <div className={pageDetailSkeletonStyle}>\n      <div className={pageDetailSkeletonTitleStyle} />\n      <BlockSuiteFallback />\n    </div>\n  );\n};\n","import { PageDetailSkeleton } from '@affine/component/page-detail-skeleton';\nimport { rootCurrentPageIdAtom } from '@affine/workspace/atom';\nimport type { EditorContainer } from '@blocksuite/editor';\nimport type { Page } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\nimport { useBlockSuiteWorkspacePage } from '@toeverything/hooks/use-block-suite-workspace-page';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { useRouter } from 'next/router';\nimport type React from 'react';\nimport { useCallback } from 'react';\n\nimport { getUIAdapter } from '../../../adapters/workspace';\nimport { pageSettingFamily } from '../../../atoms';\nimport { rootCurrentWorkspaceAtom } from '../../../atoms/root';\nimport { useCurrentWorkspace } from '../../../hooks/current/use-current-workspace';\nimport { useRouterHelper } from '../../../hooks/use-router-helper';\nimport { WorkspaceLayout } from '../../../layouts/workspace-layout';\nimport type { NextPageWithLayout } from '../../../shared';\n\nconst WorkspaceDetail: React.FC = () => {\n  const router = useRouter();\n  const { openPage } = useRouterHelper(router);\n  const currentPageId = useAtomValue(rootCurrentPageIdAtom);\n  const [currentWorkspace] = useCurrentWorkspace();\n  assertExists(currentWorkspace);\n  assertExists(currentPageId);\n  const blockSuiteWorkspace = currentWorkspace.blockSuiteWorkspace;\n  const [setting, setSetting] = useAtom(pageSettingFamily(currentPageId));\n  if (!setting) {\n    setSetting({\n      mode: 'page',\n    });\n  }\n\n  const onLoad = useCallback(\n    (page: Page, editor: EditorContainer) => {\n      const dispose = editor.slots.pageLinkClicked.on(({ pageId }) => {\n        return openPage(blockSuiteWorkspace.id, pageId);\n      });\n      return () => {\n        dispose.dispose();\n      };\n    },\n    [blockSuiteWorkspace.id, openPage]\n  );\n\n  const { PageDetail, Header } = getUIAdapter(currentWorkspace.flavour);\n  return (\n    <>\n      <Header\n        currentWorkspace={currentWorkspace}\n        currentEntry={{\n          pageId: currentPageId,\n        }}\n      />\n      <PageDetail\n        currentWorkspace={currentWorkspace}\n        currentPageId={currentPageId}\n        onLoadEditor={onLoad}\n      />\n    </>\n  );\n};\n\nconst WorkspaceDetailPage: NextPageWithLayout = () => {\n  const router = useRouter();\n  const currentWorkspace = useAtomValue(rootCurrentWorkspaceAtom);\n  const currentPageId = useAtomValue(rootCurrentPageIdAtom);\n  const page = useBlockSuiteWorkspacePage(\n    currentWorkspace.blockSuiteWorkspace,\n    currentPageId\n  );\n  if (!router.isReady) {\n    return <PageDetailSkeleton key=\"router-not-ready\" />;\n  } else if (!currentPageId || !page) {\n    return <PageDetailSkeleton key=\"current-page-is-null\" />;\n  }\n  return <WorkspaceDetail />;\n};\n\nexport default WorkspaceDetailPage;\n\nWorkspaceDetailPage.getLayout = page => {\n  return <WorkspaceLayout>{page}</WorkspaceLayout>;\n};\n","import \"../../packages/component/src/components/block-suite-editor/index.css.ts.vanilla.css!=!../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../../packages/component/src/components/block-suite-editor/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmdsNTFjZTAgewogIG1heC13aWR0aDogdmFyKC0tYWZmaW5lLWVkaXRvci13aWR0aCk7CiAgbWFyZ2luOiAwIDJyZW07CiAgcGFkZGluZzogMCAyNHB4Owp9Ci5nbDUxY2UxIHsKICBtYXJnaW4tdG9wOiA0MHB4OwogIG1hcmdpbi1ib3R0b206IDQwcHg7Cn0=\\\"}!../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var blockSuiteEditorHeaderStyle = 'gl51ce1';\nexport var blockSuiteEditorStyle = 'gl51ce0';","import { config } from '@affine/env';\nimport { editorContainerModuleAtom } from '@affine/jotai';\nimport type { BlockHub } from '@blocksuite/blocks';\nimport type { EditorContainer } from '@blocksuite/editor';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\nimport { Skeleton } from '@mui/material';\nimport { useAtomValue } from 'jotai';\nimport type { CSSProperties, ReactElement } from 'react';\nimport { lazy, memo, Suspense, useCallback, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport type { FallbackProps } from 'react-error-boundary';\nimport { ErrorBoundary } from 'react-error-boundary';\n\nimport {\n  blockSuiteEditorHeaderStyle,\n  blockSuiteEditorStyle,\n} from './index.css';\n\nexport type EditorProps = {\n  page: Page;\n  mode: 'page' | 'edgeless';\n  onInit: (page: Page, editor: Readonly<EditorContainer>) => void;\n  onLoad?: (page: Page, editor: EditorContainer) => () => void;\n  style?: CSSProperties;\n};\n\nexport type ErrorBoundaryProps = {\n  onReset?: () => void;\n};\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var currentPage: Page | undefined;\n  // eslint-disable-next-line no-var\n  var currentEditor: EditorContainer | undefined;\n}\n\nconst ImagePreviewModal = lazy(() =>\n  import('../image-preview-modal').then(module => ({\n    default: module.ImagePreviewModal,\n  }))\n);\n\nconst BlockSuiteEditorImpl = (props: EditorProps): ReactElement => {\n  const { onLoad, page, mode, style, onInit } = props;\n  const JotaiEditorContainer = useAtomValue(\n    editorContainerModuleAtom\n  ) as typeof EditorContainer;\n  assertExists(page, 'page should not be null');\n  const editorRef = useRef<EditorContainer | null>(null);\n  const blockHubRef = useRef<BlockHub | null>(null);\n  if (editorRef.current === null) {\n    editorRef.current = new JotaiEditorContainer();\n    editorRef.current.autofocus = true;\n    globalThis.currentEditor = editorRef.current;\n  }\n  const editor = editorRef.current;\n  assertExists(editorRef, 'editorRef.current should not be null');\n  if (editor.mode !== mode) {\n    editor.mode = mode;\n  }\n\n  useEffect(() => {\n    if (editor.page !== page) {\n      editor.page = page;\n      if (page.root === null) {\n        onInit(page, editor);\n      }\n    }\n  }, [editor, page, onInit]);\n\n  useEffect(() => {\n    if (editor.page && onLoad) {\n      const disposes = [] as ((() => void) | undefined)[];\n      disposes.push(onLoad?.(page, editor));\n      return () => {\n        disposes\n          .filter((dispose): dispose is () => void => !!dispose)\n          .forEach(dispose => dispose());\n      };\n    }\n    return;\n  }, [editor, editor.page, page, onLoad]);\n\n  const ref = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const editor = editorRef.current;\n    assertExists(editor);\n    const container = ref.current;\n    if (!container) {\n      return;\n    }\n    if (page.awarenessStore.getFlag('enable_block_hub')) {\n      editor\n        .createBlockHub()\n        .then(blockHub => {\n          if (blockHubRef.current) {\n            blockHubRef.current.remove();\n          }\n          blockHubRef.current = blockHub;\n          const toolWrapper = document.querySelector('#toolWrapper');\n          if (!toolWrapper) {\n            console.warn(\n              'toolWrapper not found, block hub feature will not be available.'\n            );\n          } else {\n            toolWrapper.appendChild(blockHub);\n          }\n        })\n        .catch(err => {\n          console.error(err);\n        });\n    }\n\n    container.appendChild(editor);\n    return () => {\n      blockHubRef.current?.remove();\n      container.removeChild(editor);\n    };\n  }, [editor, page]);\n\n  // issue: https://github.com/toeverything/AFFiNE/issues/2004\n  const className = `editor-wrapper ${editor.mode}-mode`;\n  return (\n    <div\n      data-testid={`editor-${page.id}`}\n      className={className}\n      style={style}\n      ref={ref}\n    />\n  );\n};\n\nconst BlockSuiteErrorFallback = (\n  props: FallbackProps & ErrorBoundaryProps\n): ReactElement => {\n  return (\n    <div>\n      <h1>Sorry.. there was an error</h1>\n      <div>{props.error.message}</div>\n      <button\n        data-testid=\"error-fallback-reset-button\"\n        onClick={() => {\n          props.onReset?.();\n          props.resetErrorBoundary();\n        }}\n      >\n        Try again\n      </button>\n    </div>\n  );\n};\n\nexport const BlockSuiteFallback = memo(function BlockSuiteFallback() {\n  return (\n    <div className={blockSuiteEditorStyle}>\n      <Skeleton\n        className={blockSuiteEditorHeaderStyle}\n        animation=\"wave\"\n        height={50}\n      />\n      <Skeleton animation=\"wave\" height={30} width=\"40%\" />\n    </div>\n  );\n});\n\nexport const BlockSuiteEditor = memo(function BlockSuiteEditor(\n  props: EditorProps & ErrorBoundaryProps\n): ReactElement {\n  return (\n    <ErrorBoundary\n      fallbackRender={useCallback(\n        (fallbackProps: FallbackProps) => (\n          <BlockSuiteErrorFallback {...fallbackProps} onReset={props.onReset} />\n        ),\n        [props.onReset]\n      )}\n    >\n      <Suspense fallback={<BlockSuiteFallback />}>\n        <BlockSuiteEditorImpl {...props} />\n      </Suspense>\n      {config.enableImagePreviewModal && props.page && (\n        <Suspense fallback={null}>\n          {createPortal(\n            <ImagePreviewModal\n              workspace={props.page.workspace}\n              pageId={props.page.id}\n            />,\n            document.body\n          )}\n        </Suspense>\n      )}\n    </ErrorBoundary>\n  );\n});\n\nBlockSuiteEditor.displayName = 'BlockSuiteEditor';\n","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","'use client';\nimport { createContext, Component, isValidElement, createElement, useContext, useState, useMemo, forwardRef } from 'react';\n\nconst ErrorBoundaryContext = createContext(null);\n\nconst initialState = {\n  didCatch: false,\n  error: null\n};\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.resetErrorBoundary = this.resetErrorBoundary.bind(this);\n    this.state = initialState;\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      didCatch: true,\n      error\n    };\n  }\n  resetErrorBoundary() {\n    const {\n      error\n    } = this.state;\n    if (error !== null) {\n      var _this$props$onReset, _this$props;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      (_this$props$onReset = (_this$props = this.props).onReset) === null || _this$props$onReset === void 0 ? void 0 : _this$props$onReset.call(_this$props, {\n        args,\n        reason: \"imperative-api\"\n      });\n      this.setState(initialState);\n    }\n  }\n  componentDidCatch(error, info) {\n    var _this$props$onError, _this$props2;\n    (_this$props$onError = (_this$props2 = this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props2, error, info);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const {\n      didCatch\n    } = this.state;\n    const {\n      resetKeys\n    } = this.props;\n\n    // There's an edge case where if the thing that triggered the error happens to *also* be in the resetKeys array,\n    // we'd end up resetting the error boundary immediately.\n    // This would likely trigger a second error to be thrown.\n    // So we make sure that we don't check the resetKeys on the first call of cDU after the error is set.\n\n    if (didCatch && prevState.error !== null && hasArrayChanged(prevProps.resetKeys, resetKeys)) {\n      var _this$props$onReset2, _this$props3;\n      (_this$props$onReset2 = (_this$props3 = this.props).onReset) === null || _this$props$onReset2 === void 0 ? void 0 : _this$props$onReset2.call(_this$props3, {\n        next: resetKeys,\n        prev: prevProps.resetKeys,\n        reason: \"keys\"\n      });\n      this.setState(initialState);\n    }\n  }\n  render() {\n    const {\n      children,\n      fallbackRender,\n      FallbackComponent,\n      fallback\n    } = this.props;\n    const {\n      didCatch,\n      error\n    } = this.state;\n    let childToRender = children;\n    if (didCatch) {\n      const props = {\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      };\n      if (isValidElement(fallback)) {\n        childToRender = fallback;\n      } else if (typeof fallbackRender === \"function\") {\n        childToRender = fallbackRender(props);\n      } else if (FallbackComponent) {\n        childToRender = createElement(FallbackComponent, props);\n      } else {\n        throw new Error(\"react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop\");\n      }\n    }\n    return createElement(ErrorBoundaryContext.Provider, {\n      value: {\n        didCatch,\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      }\n    }, childToRender);\n  }\n}\nfunction hasArrayChanged() {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return a.length !== b.length || a.some((item, index) => !Object.is(item, b[index]));\n}\n\nfunction assertErrorBoundaryContext(value) {\n  if (value == null || typeof value.didCatch !== \"boolean\" || typeof value.resetErrorBoundary !== \"function\") {\n    throw new Error(\"ErrorBoundaryContext not found\");\n  }\n  return true;\n}\n\nfunction useErrorBoundary() {\n  const context = useContext(ErrorBoundaryContext);\n  assertErrorBoundaryContext(context);\n  const [state, setState] = useState({\n    error: null,\n    hasError: false\n  });\n  const memoized = useMemo(() => ({\n    resetBoundary: () => {\n      context === null || context === void 0 ? void 0 : context.resetErrorBoundary();\n      setState({\n        error: null,\n        hasError: false\n      });\n    },\n    showBoundary: error => setState({\n      error,\n      hasError: true\n    })\n  }), [context === null || context === void 0 ? void 0 : context.resetErrorBoundary]);\n  if (state.hasError) {\n    throw state.error;\n  }\n  return memoized;\n}\n\nfunction withErrorBoundary(component, errorBoundaryProps) {\n  const Wrapped = forwardRef((props, ref) => createElement(ErrorBoundary, errorBoundaryProps, createElement(component, {\n    ...props,\n    ref\n  })));\n\n  // Format for display in DevTools\n  const name = component.displayName || component.name || \"Unknown\";\n  Wrapped.displayName = \"withErrorBoundary(\".concat(name, \")\");\n  return Wrapped;\n}\n\nexport { ErrorBoundary, ErrorBoundaryContext, useErrorBoundary, withErrorBoundary };\n"],"names":["window","__NEXT_P","push","__webpack_require__","PageDetailSkeleton","emotion_react_jsx_runtime_browser_esm","BX","div","className","tZ","BlockSuiteFallback","WorkspaceDetail","router","useRouter","openPage","useRouterHelper","currentPageId","useAtomValue","rootCurrentPageIdAtom","currentWorkspace","useCurrentWorkspace","assertExists","blockSuiteWorkspace","setting","setSetting","useAtom","pageSettingFamily","mode","onLoad","useCallback","page","editor","dispose","slots","pageLinkClicked","on","pageId","param","id","PageDetail","Header","getUIAdapter","flavour","HY","currentEntry","onLoadEditor","WorkspaceDetailPage","rootCurrentWorkspaceAtom","useBlockSuiteWorkspacePage","isReady","_pageId_","getLayout","WorkspaceLayout","ImagePreviewModal","lazy","Promise","all","e","then","bind","module","default","BlockSuiteEditorImpl","style","onInit","props","JotaiEditorContainer","editorContainerModuleAtom","editorRef","useRef","blockHubRef","current","autofocus","globalThis","currentEditor","useEffect","root","disposes","filter","forEach","ref","container","awarenessStore","getFlag","createBlockHub","blockHub","remove","toolWrapper","document","querySelector","appendChild","console","warn","catch","err","error","removeChild","concat","data-testid","BlockSuiteErrorFallback","h1","message","button","onClick","onReset","resetErrorBoundary","memo","Skeleton","animation","height","width","BlockSuiteEditor","ErrorBoundary","fallbackRender","fallbackProps","Suspense","fallback","config","createPortal","workspace","body","displayName","ErrorBoundaryContext","react__WEBPACK_IMPORTED_MODULE_0__","createContext","initialState","didCatch","Component","constructor","state","getDerivedStateFromError","_this$props$onReset","_this$props","_len","arguments","length","args","_key","call","reason","setState","componentDidCatch","info","_this$props$onError","_this$props2","onError","componentDidUpdate","prevProps","prevState","resetKeys","hasArrayChanged","a","undefined","b","some","item","index","Object","is","_this$props$onReset2","_this$props3","next","prev","render","children","FallbackComponent","childToRender","isValidElement","createElement","Provider","value"],"sourceRoot":""}