{"version":3,"file":"static/chunks/2509.70ab252d45c2db3f.js","mappings":"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","sources":["webpack://_N_E/../../node_modules/foxact/noop/index.mjs","webpack://_N_E/../../plugins/bookmark-block/src/blocksuite/ui.tsx","webpack://_N_E/../../plugins/bookmark-block/src/blocksuite/index.tsx","webpack://_N_E/../../node_modules/@blocksuite/blocks/dist/std.js","webpack://_N_E/<anon>"],"sourcesContent":["let o=()=>{};export{o as noop};\n","import { MenuItem, PureMenu } from '@affine/component';\nimport { MuiClickAwayListener } from '@affine/component';\nimport type { SerializedBlock } from '@blocksuite/blocks';\nimport {\n  getCurrentBlockRange,\n  getCurrentNativeRange,\n  getVirgoByModel,\n} from '@blocksuite/blocks/std';\nimport type { Page } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\nimport type { FC } from 'react';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\n\nexport type BookMarkProps = {\n  page: Page;\n};\n\ntype ShortcutMap = {\n  [key: string]: (e: KeyboardEvent, page: Page) => void;\n};\n\nconst menuOptions = [\n  {\n    id: 'dismiss',\n    label: 'Dismiss',\n  },\n  {\n    id: 'bookmark',\n    label: 'Create bookmark',\n  },\n];\n\nconst handleEnter = ({\n  page,\n  selectedOption,\n  callback,\n}: {\n  page: Page;\n  selectedOption: keyof ShortcutMap;\n  callback: () => void;\n}) => {\n  if (selectedOption === 'dismiss') {\n    return callback();\n  }\n  const blockRange = getCurrentBlockRange(page) as Exclude<\n    ReturnType<typeof getCurrentBlockRange>,\n    null\n  >;\n  const vEditor = getVirgoByModel(blockRange.models[0]);\n  const linkInfo = vEditor\n    ?.getDeltasByVRange({\n      index: blockRange.startOffset,\n      length: 0,\n    })\n    .find(delta => delta[0]?.attributes?.link);\n  if (!linkInfo) {\n    return;\n  }\n  const [, { index, length }] = linkInfo;\n  const link = linkInfo[0]?.attributes?.link as string;\n\n  const model = blockRange.models[0];\n  const parent = page.getParent(model);\n  assertExists(parent);\n  const currentBlockIndex = parent.children.indexOf(model);\n  page.addBlock(\n    'affine:bookmark',\n    { url: link },\n    parent,\n    currentBlockIndex + 1\n  );\n\n  vEditor?.deleteText({\n    index,\n    length,\n  });\n\n  if (model.isEmpty()) {\n    page.deleteBlock(model);\n  }\n  return callback();\n};\n\nconst shouldShowBookmarkMenu = (pastedBlocks: SerializedBlock[]) => {\n  if (!pastedBlocks.length || pastedBlocks.length > 1) {\n    return;\n  }\n  const [firstBlock] = pastedBlocks;\n  if (\n    !firstBlock.text ||\n    !firstBlock.text.length ||\n    firstBlock.text.length > 1\n  ) {\n    return;\n  }\n  return !!firstBlock.text[0].attributes?.link;\n};\nexport const BookMarkUI: FC<BookMarkProps> = ({ page }) => {\n  const [anchor, setAnchor] = useState<Range | null>(null);\n  const [selectedOption, setSelectedOption] = useState<string>(\n    menuOptions[0].id\n  );\n  const shortcutMap = useMemo<ShortcutMap>(\n    () => ({\n      ArrowUp: () => {\n        const curIndex = menuOptions.findIndex(\n          ({ id }) => id === selectedOption\n        );\n        if (menuOptions[curIndex - 1]) {\n          setSelectedOption(menuOptions[curIndex - 1].id);\n        } else if (curIndex === -1) {\n          setSelectedOption(menuOptions[0].id);\n        } else {\n          setSelectedOption(menuOptions[menuOptions.length - 1].id);\n        }\n      },\n      ArrowDown: () => {\n        const curIndex = menuOptions.findIndex(\n          ({ id }) => id === selectedOption\n        );\n        if (curIndex !== -1 && menuOptions[curIndex + 1]) {\n          setSelectedOption(menuOptions[curIndex + 1].id);\n        } else {\n          setSelectedOption(menuOptions[0].id);\n        }\n      },\n      Enter: () =>\n        handleEnter({\n          page,\n          selectedOption,\n          callback: () => {\n            setAnchor(null);\n          },\n        }),\n      Escape: () => {\n        setAnchor(null);\n      },\n    }),\n    [page, selectedOption]\n  );\n  const onKeydown = useCallback(\n    (e: KeyboardEvent) => {\n      const shortcut = shortcutMap[e.key];\n      if (shortcut) {\n        e.stopPropagation();\n        e.preventDefault();\n        shortcut(e, page);\n      } else {\n        setAnchor(null);\n      }\n    },\n    [page, shortcutMap]\n  );\n\n  useEffect(() => {\n    const disposer = page.slots.pasted.on(pastedBlocks => {\n      if (!shouldShowBookmarkMenu(pastedBlocks)) {\n        return;\n      }\n      setTimeout(() => {\n        setAnchor(getCurrentNativeRange());\n      }, 100);\n    });\n\n    return () => {\n      disposer.dispose();\n    };\n  }, [onKeydown, page, shortcutMap]);\n\n  useEffect(() => {\n    if (anchor) {\n      document.addEventListener('keydown', onKeydown, { capture: true });\n    } else {\n      // reset status and remove event\n      setSelectedOption(menuOptions[0].id);\n      document.removeEventListener('keydown', onKeydown, { capture: true });\n    }\n\n    return () => {\n      document.removeEventListener('keydown', onKeydown, { capture: true });\n    };\n  }, [anchor, onKeydown]);\n\n  return anchor ? (\n    <MuiClickAwayListener\n      onClickAway={() => {\n        setAnchor(null);\n        setSelectedOption('');\n      }}\n    >\n      <div>\n        <PureMenu open={!!anchor} anchorEl={anchor} placement=\"bottom-start\">\n          {menuOptions.map(({ id, label }) => {\n            return (\n              <MenuItem\n                key={id}\n                active={selectedOption === id}\n                onClick={() => {\n                  handleEnter({\n                    page,\n                    selectedOption: id,\n                    callback: () => {\n                      setAnchor(null);\n                    },\n                  });\n                }}\n                disableHover={true}\n                onMouseEnter={() => {\n                  setSelectedOption(id);\n                }}\n              >\n                {label}\n              </MenuItem>\n            );\n          })}\n        </PureMenu>\n      </div>\n    </MuiClickAwayListener>\n  ) : null;\n};\n","import type { PluginBlockSuiteAdapter } from '@toeverything/plugin-infra/type';\nimport { noop } from 'foxact/noop';\nimport { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\n\nimport { BookMarkUI } from './ui';\n\nexport default {\n  uiDecorator: editor => {\n    if (\n      editor.parentElement &&\n      editor.page.awarenessStore.getFlag('enable_bookmark_operation')\n    ) {\n      const div = document.createElement('div');\n      editor.parentElement.appendChild(div);\n      const root = createRoot(div);\n      root.render(\n        <StrictMode>\n          <BookMarkUI page={editor.page} />\n        </StrictMode>\n      );\n      return () => {\n        root.unmount();\n        div.remove();\n      };\n    } else {\n      return noop;\n    }\n  },\n} satisfies Partial<PluginBlockSuiteAdapter>;\n","/// <reference types=\"@blocksuite/global\" />\nimport * as std from './__internal__/utils/index.js';\nexport * from './__internal__/utils/index.js';\nexport default std;\n//# sourceMappingURL=std.js.map"],"names":["o","menuOptions","id","label","handleEnter","linkInfo","page","selectedOption","callback","param","blockRange","getCurrentBlockRange","vEditor","getVirgoByModel","models","getDeltasByVRange","index","startOffset","length","find","delta","attributes","link","model","parent","getParent","assertExists","currentBlockIndex","children","indexOf","addBlock","url","deleteText","isEmpty","deleteBlock","shouldShowBookmarkMenu","firstBlock","pastedBlocks","text","BookMarkUI","anchor","setAnchor","useState","setSelectedOption","shortcutMap","useMemo","ArrowUp","curIndex","findIndex","ArrowDown","Enter","Escape","onKeydown","useCallback","shortcut","e","key","stopPropagation","preventDefault","useEffect","disposer","slots","pasted","on","setTimeout","getCurrentNativeRange","dispose","document","addEventListener","capture","removeEventListener","emotion_react_jsx_runtime_browser_esm","tZ","MuiClickAwayListener","onClickAway","div","PureMenu","open","anchorEl","placement","map","MenuItem","active","onClick","disableHover","onMouseEnter","blocksuite","uiDecorator","editor","parentElement","awarenessStore","getFlag","noop","createElement","appendChild","root","createRoot","render","StrictMode","unmount","remove"],"sourceRoot":""}